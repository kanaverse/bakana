<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>steps/rna_quality_control.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/kanaverse/bakana" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Classes</h3><ul><li><a href="AbstractAlabasterDataset.html">AbstractAlabasterDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterDataset.html#.defaults">defaults</a></li></ul></li><li><a href="AbstractAlabasterResult.html">AbstractAlabasterResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="AbstractAlabasterResult.html#.defaults">defaults</a></li></ul></li><li><a href="AbstractArtifactdbDataset.html">AbstractArtifactdbDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbDataset.html#.defaults">defaults</a></li></ul></li><li><a href="AbstractArtifactdbResult.html">AbstractArtifactdbResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="AbstractArtifactdbResult.html#.defaults">defaults</a></li></ul></li><li><a href="AdtNormalizationState.html">AdtNormalizationState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AdtNormalizationState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="AdtNormalizationState.html#fetchNormalizedMatrix">fetchNormalizedMatrix</a></li><li data-type='method' style='display: none;'><a href="AdtNormalizationState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="AdtNormalizationState.html#fetchSizeFactors">fetchSizeFactors</a></li><li data-type='method' style='display: none;'><a href="AdtNormalizationState.html#.defaults">defaults</a></li></ul></li><li><a href="AdtPcaState.html">AdtPcaState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AdtPcaState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="AdtPcaState.html#fetchPCs">fetchPCs</a></li><li data-type='method' style='display: none;'><a href="AdtPcaState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="AdtPcaState.html#.defaults">defaults</a></li></ul></li><li><a href="AdtQualityControlState.html">AdtQualityControlState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#fetchFilters">fetchFilters</a></li><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#fetchKeep">fetchKeep</a></li><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#fetchMetrics">fetchMetrics</a></li><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="AdtQualityControlState.html#.defaults">defaults</a></li></ul></li><li><a href="BatchCorrectionState.html">BatchCorrectionState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#fetchCorrected">fetchCorrected</a></li><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#fetchNumberOfCells">fetchNumberOfCells</a></li><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#fetchNumberOfDimensions">fetchNumberOfDimensions</a></li><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="BatchCorrectionState.html#.defaults">defaults</a></li></ul></li><li><a href="CellFilteringState.html">CellFilteringState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CellFilteringState.html#applyFilter">applyFilter</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#fetchFilteredBlock">fetchFilteredBlock</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#fetchFilteredMatrix">fetchFilteredMatrix</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#fetchKeep">fetchKeep</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#undoFilter">undoFilter</a></li><li data-type='method' style='display: none;'><a href="CellFilteringState.html#.defaults">defaults</a></li></ul></li><li><a href="CellLabellingStandalone.html">CellLabellingStandalone</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#computeLabels">computeLabels</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#ready">ready</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#setParameters">setParameters</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#.flush">flush</a></li><li data-type='method' style='display: none;'><a href="CellLabellingStandalone.html#.setDownload">setDownload</a></li></ul></li><li><a href="CellLabellingState.html">CellLabellingState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CellLabellingState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#computeLabels">computeLabels</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#fetchNumberOfSharedFeatures">fetchNumberOfSharedFeatures</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#.flush">flush</a></li><li data-type='method' style='display: none;'><a href="CellLabellingState.html#.setDownload">setDownload</a></li></ul></li><li><a href="ChooseClusteringState.html">ChooseClusteringState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ChooseClusteringState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="ChooseClusteringState.html#fetchClusters">fetchClusters</a></li><li data-type='method' style='display: none;'><a href="ChooseClusteringState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="ChooseClusteringState.html#.defaults">defaults</a></li></ul></li><li><a href="CombineEmbeddingsState.html">CombineEmbeddingsState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#fetchCombined">fetchCombined</a></li><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#fetchNumberOfCells">fetchNumberOfCells</a></li><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#fetchNumberOfDimensions">fetchNumberOfDimensions</a></li><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CombineEmbeddingsState.html#.defaults">defaults</a></li></ul></li><li><a href="CrisprNormalizationState.html">CrisprNormalizationState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CrisprNormalizationState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CrisprNormalizationState.html#fetchNormalizedMatrix">fetchNormalizedMatrix</a></li><li data-type='method' style='display: none;'><a href="CrisprNormalizationState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CrisprNormalizationState.html#fetchSizeFactors">fetchSizeFactors</a></li><li data-type='method' style='display: none;'><a href="CrisprNormalizationState.html#.defaults">defaults</a></li></ul></li><li><a href="CrisprPcaState.html">CrisprPcaState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CrisprPcaState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CrisprPcaState.html#fetchPCs">fetchPCs</a></li><li data-type='method' style='display: none;'><a href="CrisprPcaState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CrisprPcaState.html#.defaults">defaults</a></li></ul></li><li><a href="CrisprQualityControlState.html">CrisprQualityControlState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#fetchFilters">fetchFilters</a></li><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#fetchKeep">fetchKeep</a></li><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#fetchMetrics">fetchMetrics</a></li><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CrisprQualityControlState.html#.defaults">defaults</a></li></ul></li><li><a href="CustomSelectionsStandalone.html">CustomSelectionsStandalone</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#addSelection">addSelection</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#computeVersus">computeVersus</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#fetchBlockLevels">fetchBlockLevels</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#fetchSelectionIndices">fetchSelectionIndices</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#fetchSelections">fetchSelections</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#free">free</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#removeSelection">removeSelection</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#setParameters">setParameters</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsStandalone.html#.defaults">defaults</a></li></ul></li><li><a href="CustomSelectionsState.html">CustomSelectionsState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#addSelection">addSelection</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#computeVersus">computeVersus</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#fetchSelectionIndices">fetchSelectionIndices</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#fetchSelections">fetchSelections</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#free">free</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#removeSelection">removeSelection</a></li><li data-type='method' style='display: none;'><a href="CustomSelectionsState.html#.defaults">defaults</a></li></ul></li><li><a href="FeatureSelectionState.html">FeatureSelectionState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="FeatureSelectionState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="FeatureSelectionState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="FeatureSelectionState.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="FeatureSelectionState.html#fetchSortedResiduals">fetchSortedResiduals</a></li><li data-type='method' style='display: none;'><a href="FeatureSelectionState.html#.defaults">defaults</a></li></ul></li><li><a href="FeatureSetEnrichmentStandalone.html">FeatureSetEnrichmentStandalone</a><ul class='methods'><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#computeEnrichment">computeEnrichment</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#computePerCellScores">computePerCellScores</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#fetchCollectionDetails">fetchCollectionDetails</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#fetchFeatureSetIndices">fetchFeatureSetIndices</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#fetchSetDetails">fetchSetDetails</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#fetchUniverseSize">fetchUniverseSize</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#free">free</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#ready">ready</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#setParameters">setParameters</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentStandalone.html#.defaults">defaults</a></li></ul></li><li><a href="FeatureSetEnrichmentState.html">FeatureSetEnrichmentState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#computeEnrichment">computeEnrichment</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#computePerCellScores">computePerCellScores</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#fetchCollectionDetails">fetchCollectionDetails</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#fetchFeatureSetIndices">fetchFeatureSetIndices</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#fetchSetDetails">fetchSetDetails</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#fetchUniverseSize">fetchUniverseSize</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#free">free</a></li><li data-type='method' style='display: none;'><a href="FeatureSetEnrichmentState.html#.defaults">defaults</a></li></ul></li><li><a href="H5adDataset.html">H5adDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="H5adDataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="H5adDataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="H5adResult.html">H5adResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="H5adResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="H5adResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="H5adResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="H5adResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="H5adResult.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="H5adResult.html#.defaults">defaults</a></li></ul></li><li><a href="InputsState.html">InputsState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="InputsState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#enableDatasetCache">enableDatasetCache</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchBlock">fetchBlock</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchBlockLevels">fetchBlockLevels</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchCellAnnotations">fetchCellAnnotations</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchCountMatrix">fetchCountMatrix</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchDirectSubset">fetchDirectSubset</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchFeatureAnnotations">fetchFeatureAnnotations</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#setDirectSubset">setDirectSubset</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#undoSubset">undoSubset</a></li><li data-type='method' style='display: none;'><a href="InputsState.html#.defaults">defaults</a></li></ul></li><li><a href="KmeansClusterState.html">KmeansClusterState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="KmeansClusterState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="KmeansClusterState.html#fetchClusters">fetchClusters</a></li><li data-type='method' style='display: none;'><a href="KmeansClusterState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="KmeansClusterState.html#.defaults">defaults</a></li></ul></li><li><a href="MarkerDetectionStandalone.html">MarkerDetectionStandalone</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#computeAll">computeAll</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#computeVersus">computeVersus</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#fetchBlockLevels">fetchBlockLevels</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#fetchGroupLevels">fetchGroupLevels</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#free">free</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#setParameters">setParameters</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionStandalone.html#.defaults">defaults</a></li></ul></li><li><a href="MarkerDetectionState.html">MarkerDetectionState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#computeVersus">computeVersus</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#free">free</a></li><li data-type='method' style='display: none;'><a href="MarkerDetectionState.html#.defaults">defaults</a></li></ul></li><li><a href="NeighborIndexState.html">NeighborIndexState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="NeighborIndexState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="NeighborIndexState.html#fetchIndex">fetchIndex</a></li><li data-type='method' style='display: none;'><a href="NeighborIndexState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="NeighborIndexState.html#.defaults">defaults</a></li></ul></li><li><a href="RnaNormalizationState.html">RnaNormalizationState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RnaNormalizationState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="RnaNormalizationState.html#fetchNormalizedMatrix">fetchNormalizedMatrix</a></li><li data-type='method' style='display: none;'><a href="RnaNormalizationState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="RnaNormalizationState.html#fetchSizeFactors">fetchSizeFactors</a></li><li data-type='method' style='display: none;'><a href="RnaNormalizationState.html#.defaults">defaults</a></li></ul></li><li><a href="RnaPcaState.html">RnaPcaState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RnaPcaState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="RnaPcaState.html#fetchPCs">fetchPCs</a></li><li data-type='method' style='display: none;'><a href="RnaPcaState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="RnaPcaState.html#.defaults">defaults</a></li></ul></li><li><a href="RnaQualityControlState.html">RnaQualityControlState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#fetchFilters">fetchFilters</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#fetchKeep">fetchKeep</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#fetchMetrics">fetchMetrics</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#.flush">flush</a></li><li data-type='method' style='display: none;'><a href="RnaQualityControlState.html#.setDownload">setDownload</a></li></ul></li><li><a href="SimpleFile.html">SimpleFile</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SimpleFile.html#buffer">buffer</a></li><li data-type='method' style='display: none;'><a href="SimpleFile.html#content">content</a></li><li data-type='method' style='display: none;'><a href="SimpleFile.html#name">name</a></li><li data-type='method' style='display: none;'><a href="SimpleFile.html#size">size</a></li></ul></li><li><a href="SnnGraphClusterState.html">SnnGraphClusterState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SnnGraphClusterState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="SnnGraphClusterState.html#fetchClusters">fetchClusters</a></li><li data-type='method' style='display: none;'><a href="SnnGraphClusterState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="SnnGraphClusterState.html#.defaults">defaults</a></li></ul></li><li><a href="SummarizedExperimentDataset.html">SummarizedExperimentDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentDataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="SummarizedExperimentResult.html">SummarizedExperimentResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="SummarizedExperimentResult.html#.defaults">defaults</a></li></ul></li><li><a href="TenxHdf5Dataset.html">TenxHdf5Dataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="TenxHdf5Dataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="TenxMatrixMarketDataset.html">TenxMatrixMarketDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#.defaults">defaults</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="TenxMatrixMarketDataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="TsneState.html">TsneState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TsneState.html#animate">animate</a></li><li data-type='method' style='display: none;'><a href="TsneState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="TsneState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="TsneState.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="TsneState.html#.defaults">defaults</a></li></ul></li><li><a href="UmapState.html">UmapState</a><ul class='methods'><li data-type='method' style='display: none;'><a href="UmapState.html#animate">animate</a></li><li data-type='method' style='display: none;'><a href="UmapState.html#compute">compute</a></li><li data-type='method' style='display: none;'><a href="UmapState.html#fetchParameters">fetchParameters</a></li><li data-type='method' style='display: none;'><a href="UmapState.html#fetchResults">fetchResults</a></li><li data-type='method' style='display: none;'><a href="UmapState.html#.defaults">defaults</a></li></ul></li><li><a href="ZippedAlabasterDataset.html">ZippedAlabasterDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterDataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="ZippedAlabasterResult.html">ZippedAlabasterResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ZippedAlabasterResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="ZippedAlabasterResult.html#summary">summary</a></li></ul></li><li><a href="ZippedArtifactdbDataset.html">ZippedArtifactdbDataset</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#abbreviate">abbreviate</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#load">load</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#options">options</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#previewPrimaryIds">previewPrimaryIds</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#serialize">serialize</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#summary">summary</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#.format">format</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbDataset.html#.unserialize">unserialize</a></li></ul></li><li><a href="ZippedArtifactdbResult.html">ZippedArtifactdbResult</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ZippedArtifactdbResult.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbResult.html#load">load</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbResult.html#options">options</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbResult.html#setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="ZippedArtifactdbResult.html#summary">summary</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-DataFrame.html">external:DataFrame</a></li><li><a href="external-ModelGeneVarResults.html">external:ModelGeneVarResults</a></li><li><a href="external-MultiMatrix.html">external:MultiMatrix</a></li><li><a href="external-PerCellAdtQcMetricsResults.html">external:PerCellAdtQcMetricsResults</a></li><li><a href="external-PerCellCrisprQcMetricsResults.html">external:PerCellCrisprQcMetricsResults</a></li><li><a href="external-PerCellRnaQcMetricsResults.html">external:PerCellRnaQcMetricsResults</a></li><li><a href="external-RunPCAResults.html">external:RunPCAResults</a></li><li><a href="external-ScoreMarkersResults.html">external:ScoreMarkersResults</a></li><li><a href="external-ScranMatrix.html">external:ScranMatrix</a></li><li><a href="external-SuggestAdtQcFiltersResults.html">external:SuggestAdtQcFiltersResults</a></li><li><a href="external-SuggestCrisprQcFiltersResults.html">external:SuggestCrisprQcFiltersResults</a></li><li><a href="external-SuggestRnaQcFiltersResults.html">external:SuggestRnaQcFiltersResults</a></li></ul><h3>Global</h3><ul><li><a href="global.html#AlabasterProjectNavigator">AlabasterProjectNavigator</a></li><li><a href="global.html#ArtifactdbProjectNavigator">ArtifactdbProjectNavigator</a></li><li><a href="global.html#Dataset">Dataset</a></li><li><a href="global.html#analysisDefaults">analysisDefaults</a></li><li><a href="global.html#availableReaders">availableReaders</a></li><li><a href="global.html#callScran">callScran</a></li><li><a href="global.html#configureApproximateNeighbors">configureApproximateNeighbors</a></li><li><a href="global.html#configureBatchCorrection">configureBatchCorrection</a></li><li><a href="global.html#createAnalysis">createAnalysis</a></li><li><a href="global.html#freeAnalysis">freeAnalysis</a></li><li><a href="global.html#guessApproximateNeighborsConfig">guessApproximateNeighborsConfig</a></li><li><a href="global.html#guessBatchCorrectionConfig">guessBatchCorrectionConfig</a></li><li><a href="global.html#initialize">initialize</a></li><li><a href="global.html#promoteToNumber">promoteToNumber</a></li><li><a href="global.html#readLines2">readLines2</a></li><li><a href="global.html#readTable2">readTable2</a></li><li><a href="global.html#retrieveParameters">retrieveParameters</a></li><li><a href="global.html#runAnalysis">runAnalysis</a></li><li><a href="global.html#saveGenewiseResults">saveGenewiseResults</a></li><li><a href="global.html#saveSingleCellExperiment">saveSingleCellExperiment</a></li><li><a href="global.html#searchZippedAlabaster">searchZippedAlabaster</a></li><li><a href="global.html#searchZippedArtifactdb">searchZippedArtifactdb</a></li><li><a href="global.html#serializeConfiguration">serializeConfiguration</a></li><li><a href="global.html#serializeDatasets">serializeDatasets</a></li><li><a href="global.html#setCreateLink">setCreateLink</a></li><li><a href="global.html#setResolveLink">setResolveLink</a></li><li><a href="global.html#setVisualizationAnimate">setVisualizationAnimate</a></li><li><a href="global.html#subsetInputs">subsetInputs</a></li><li><a href="global.html#summarizeArray">summarizeArray</a></li><li><a href="global.html#terminate">terminate</a></li><li><a href="global.html#unserializeConfiguration">unserializeConfiguration</a></li><li><a href="global.html#unserializeDatasets">unserializeDatasets</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">steps/rna_quality_control.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import * as scran from "scran.js"; 
import * as bioc from "bioconductor";
import * as utils from "./utils/general.js";
import * as inputs_module from "./inputs.js";
import * as rutils from "../readers/index.js";

const baseUrl = "https://github.com/kanaverse/kana-special-features/releases/download/v1.0.0";

export const step_name = "rna_quality_control";

/**
 * Results of computing per-cell RNA-derived QC metrics,
 * see [here](https://kanaverse.github.io/scran.js/PerCellRnaQcMetricsResults.html) for details.
 *
 * @external PerCellRnaQcMetricsResults
 */

/**
 * Suggested filters for the RNA-derived QC metrics,
 * see [here](https://kanaverse.github.io/scran.js/SuggestRnaQcFiltersResults.html) for details.
 *
 * @external SuggestRnaQcFiltersResults
 */

/**
 * This step applies quality control on the RNA count matrix.
 * Specifically, it computes the QC metrics and filtering thresholds, 
 * wrapping the [`perCellRnaQcMetrics`](https://kanaverse.github.io/scran.js/global.html#perCellRnaQcMetrics)
 * and [`suggestRnaQcFilters`](https://kanaverse.github.io/scran.js/global.html#suggestRnaQcFilters) functions
 * from [**scran.js**](https://github.com/kanaverse/scran.js).
 * Note that the actual filtering is done by {@linkplain CellFilteringState}.
 *
 * Methods not documented here are not part of the stable API and should not be used by applications.
 * @hideconstructor
 */
export class RnaQualityControlState {
    #inputs;
    #cache;
    #parameters;

    constructor(inputs, parameters = null, cache = null) {
        if (!(inputs instanceof inputs_module.InputsState)) {
            throw new Error("'inputs' should be an InputsState object");
        }
        this.#inputs = inputs;

        this.#parameters = (parameters === null ? {} : parameters);
        this.#cache = (cache === null ? {} : cache);
        this.changed = false;
    }

    free() {
        utils.freeCache(this.#cache.metrics);
        utils.freeCache(this.#cache.filters);
        utils.freeCache(this.#cache.metrics_buffer);
        utils.freeCache(this.#cache.keep_buffer);
    }

    /***************************
     ******** Getters **********
     ***************************/
    
    valid() {
        let input = this.#inputs.fetchCountMatrix();
        return input.has("RNA");
    }

    /**
     * @return {object} Object containing the parameters.
     */
    fetchParameters() {
        let output = { ...this.#parameters }; // avoid pass-by-reference links.
        output.species = bioc.CLONE(output.species);
        return output;
    }

    /**
     * @return {Uint8WasmArray} Buffer containing a vector of length equal to the number of cells,
     * where each element is truthy if the corresponding cell is to be retained after filtering.
     * This is available after running {@linkcode RnaQualityControlState#compute compute}.
     */
    fetchKeep() {
        return this.#cache.keep_buffer;
    }

    /**
     * @return {external:SuggestRnaQcFiltersResults} Result of filtering on the RNA-derived QC metrics.
     * This is available after running {@linkcode RnaQualityControlState#compute compute}.
     */
    fetchFilters() {
        return this.#cache.filters;
    }

    /**
     * @return {external:PerCellRnaQcMetricsResults} RNA-derived QC metrics,
     * available after running {@linkcode RnaQualityControlState#compute compute}.
     */
    fetchMetrics() {
        return this.#cache.metrics;
    }

    /****************************
     ******** Defaults **********
     ****************************/

    /**
     * @return {object} Object containing default parameters,
     * see the `parameters` argument in {@linkcode RnaQualityControlState#compute compute} for details.
     */
    static defaults () {
        return {
            guess_ids: true,
            gene_id_column: null,
            use_reference_mito: true,
            species: [],
            gene_id_type: "ENSEMBL",
            mito_prefix: "mt-",

            filter_strategy: "automatic", 
            nmads: 3,

            sum_threshold: 100,
            detected_threshold: 100,
            mito_threshold: 0.2
        };
    }

    static configureFeatureParameters(use_reference_mito, guesses) {
        let best_key = null;
        let best = { type: "symbol", species: "9606", confidence: 0 };

        if ("row_names" in guesses) {
            let val = guesses.row_names;
            if (val.confidence > best.confidence &amp;&amp; (use_reference_mito || val.type == "symbol")) {
                best = val;
            }
        }

        for (const [key, val] of Object.entries(guesses.columns)) {
            if (val.confidence > best.confidence &amp;&amp; (use_reference_mito || val.type == "symbol")) {
                best = val;
                best_key = key;
            }
        }

        return {
            gene_id_column: best_key,
            species: [best.species],
            gene_id_type: best.type.toUpperCase()
        };
    }

    /**
     * Array of strings containing the taxonomy IDs for species where mitochondrial gene lists are available.
     * @type {Array}
     */
    static mitochondriaSpecies = [ 
        "9606",  // Mouse
        "10090", // Human
        "6239",  // C. elegans
        "10116", // Rat
        "9541",  // M. fascicularis
        "7227",  // Fly
        "7955",  // Zebrafish
        "9598"   // Chimp
    ];

    /***************************
     ******** Remotes **********
     ***************************/

    async #acquire_reference(species, feature_type) {
        let output = new Set;
        let mito_lists = RnaQualityControlState.#mito_lists;

        for (const s of species) {
            let target = s + "-mito-" + feature_type.toLowerCase() + ".txt.gz";
            if (!(target in mito_lists)) {
                let contents = await RnaQualityControlState.#downloadFun(baseUrl + "/" + target);
                let lines = await rutils.readLines2(contents, { compression: "gz" });
                mito_lists[target] = lines;
            }

            mito_lists[target].forEach(x => { output.add(x); });
        }

        return output;
    }

    static #mito_lists = {};

    /**
     * Flush all cached lists of mitochondrial genes.
     *
     * By default, {@linkcode RnaQualityControlState#compute compute} will cache the mitochondrial gene lists in a static member for re-use across {@linkplain RnaQualityControlState} instances.
     * These cached lists are not tied to any single instance and will not be removed by garbage collectors or by {@linkcode freeAnalysis}.
     * Rather, this function should be called to release the relevant memory.
     */
    static flush() {
        RnaQualityControlState.#mito_lists = {};
        return;
    }

    static #downloadFun = utils.defaultDownload;

    /**
     * Specify a function to download the reference mitochondrial gene lists.
     *
     * @param {function} fun - Function that accepts a single string containing a URL and returns any value that can be used in the {@linkplain SimpleFile} constructor.
     * This is most typically a Uint8Array of that URL's contents, but it can also be a path to a locally cached file on Node.js.
     *
     * @return `fun` is set as the global downloader for this step. 
     * The _previous_ value of the downloader is returned.
     */
    static setDownload(fun) {
        let previous = RnaQualityControlState.#downloadFun;
        RnaQualityControlState.#downloadFun = fun;
        return previous;
    }

    /***************************
     ******** Compute **********
     ***************************/

    /**
     * This method should not be called directly by users, but is instead invoked by {@linkcode runAnalysis}.
     *
     * @param {object} parameters - Parameter object, equivalent to the `rna_quality_control` property of the `parameters` of {@linkcode runAnalysis}.
     * @param {boolean} [parameters.guess_ids] - Automatically choose feature-based parameters based on the feature annotation for the RNA modality.
     * If set to `true`, the following logic is applied:
     *
     * - If `use_reference_mito = true`, the annotation column that best matches human/mouse Ensembl/symbols is set as `gene_id_column`.
     *   Based on the identified species and feature type, `species` and `gene_id_type` are also set.
     * - If `use_reference_mito = false`, the annotation column that best matches human/mouse symbols is set as `gene_id_column`.
     *
     * @param {?(string|number)} [parameters.gene_id_column] - Name or index of the column of the feature annotations that contains the gene identifiers for the RNA modality.
     * If `null`, the row names are used.
     * Ignored if `guess_ids = true`.
     * @param {boolean} [parameters.use_reference_mito] - Whether to use the reference lists of mitochondrial genes.
     * If `false`, mitochondrial genes are instead identified from their prefix.
     * @param {Array} [parameters.species] - Array of strings specifying zero, one or more species to use to obtain a reference list of mitochondrial genes.
     * Each entry should be a taxonomy ID (e.g. `"9606"`, `"10090"`) as specified in {@linkcode RnaQualityControlState#mitochondriaSpecies mitochondriaSpecies}).
     * Ignored if `guess_ids = true`.
     * @param {string} [parameters.gene_id_type] - Name of the feature type in the reference list of mitochondrial genes.
     * This can be any one of `"ENSEMBL"`, `"SYMBOL"`, or `"ENTREZ"`.
     * Ignored if `guess_ids = true`.
     * @param {?string} [parameters.mito_prefix] - Case-insensitive prefix to use to identify mitochondrial genes from the dataset.
     * Only used when `use_reference_mito = false`; in such cases, `gene_id_column` should point to symbols.
     * If `null`, no prefix-based identification is performed.
     * @param {string} [parameters.filter_strategy] - Strategy for defining a filter threshold for the QC metrics.
     * This can be `"automatic"` or `"manual"`.
     * @param {number} [parameters.nmads] - Number of MADs to use for automatically selecting the filter threshold for each metric.
     * Only used when `filter_strategy = "automatic"`.
     * @param {number} [parameters.sum_threshold] - Manual threshold on the sum of counts for each cell.
     * Cells are only retained if their sums are equal to or greater than this threshold.
     * Only used when `filter_strategy = "manual"`.
     * @param {number} [parameters.detected_threshold] - Manual threshold on the detected number of features for each cell.
     * Cells are only retained if the detected number is equal to or greater than this threshold.
     * Only used when `filter_strategy = "manual"`.
     * @param {number} [parameters.mito_threshold] - Manual threshold on the mitochondrial proportion for each cell.
     * Cells are only retained if their totals are less than or equal to this threshold.
     * Only used when `filter_strategy = "manual"`.
     *
     * @return The object is updated with the new results.
     * @async
     */
    async compute(parameters) {
        parameters = utils.defaultizeParameters(parameters, RnaQualityControlState.defaults(), ["automatic"]);
        this.changed = false;

        // Some back-compatibility here.
        if (typeof parameters.guess_ids == "undefined") {
            if ("automatic" in parameters) {
                parameters.guess_ids = parameters.automatic;
            } else {
                parameters.guess_ids = true;
            }
        }

        if (
            this.#inputs.changed || 
            parameters.guess_ids !== this.#parameters.guess_ids ||
            parameters.use_reference_mito !== this.#parameters.use_reference_mito || 
            (
                !parameters.guess_ids &amp;&amp; 
                (
                    parameters.gene_id_column !== this.#parameters.gene_id_column || 
                    (!parameters.use_reference_mito &amp;&amp; parameters.mito_prefix !== this.#parameters.mito_prefix) ||
                    (
                        parameters.use_reference_mito &amp;&amp; 
                        (
                            utils.changedParameters(parameters.species, this.#parameters.species) || 
                            parameters.gene_id_type !== this.#parameters.gene_id_type
                        )
                    )
                )
            ) 
        ) {
            utils.freeCache(this.#cache.metrics);

            if (this.valid()) {
                let gene_id_column2 = parameters.gene_id_column;
                let species2 = parameters.species;
                let gene_id_type2 = parameters.gene_id_type;

                if (parameters.guess_ids) {
                    let guesses = this.#inputs.guessRnaFeatureTypes();
                    let backcomp = RnaQualityControlState.configureFeatureParameters(parameters.use_reference_mito, guesses);
                    gene_id_column2 = backcomp.gene_id_column;
                    species2 = backcomp.species;
                    gene_id_type2 = backcomp.gene_id_type;
                }

                var gene_info = this.#inputs.fetchFeatureAnnotations()["RNA"];
                let val = (gene_id_column2 == null ? gene_info.rowNames() : gene_info.column(gene_id_column2));
                var subsets = utils.allocateCachedArray(gene_info.numberOfRows(), "Uint8Array", this.#cache, "metrics_buffer");
                subsets.fill(0);

                if (val !== null) {
                    if (parameters.use_reference_mito) {
                        let lists = await this.#acquire_reference(species2, gene_id_type2);
                        var sub_arr = subsets.array();
                        val.forEach((x, i) => {
                            if (lists.has(x)) {
                                sub_arr[i] = 1;
                            }
                        });
                    } else if (parameters.mito_prefix !== null) {
                        var lower_mito = parameters.mito_prefix.toLowerCase();
                        var sub_arr = subsets.array();
                        val.forEach((x, i) => {
                            if(x.toLowerCase().startsWith(lower_mito)) {
                                sub_arr[i] = 1;
                            }
                        });
                    }
                }

                var mat = this.#inputs.fetchCountMatrix().get("RNA");
                this.#cache.metrics = scran.perCellRnaQcMetrics(mat, [subsets]);
                this.changed = true;
            } else {
                delete this.#cache.metrics;
            }
        }

        if (this.changed || 
            parameters.filter_strategy !== this.#parameters.filter_strategy ||
            parameters.nmads !== this.#parameters.nmads ||
            parameters.sum_threshold !== this.#parameters.sum_threshold ||
            parameters.detected_threshold !== this.#parameters.detected_threshold ||
            parameters.mito_threshold !== this.#parameters.mito_threshold
        ) {
            utils.freeCache(this.#cache.filters);

            if (this.valid()) {
                let block = this.#inputs.fetchBlock();

                if (parameters.filter_strategy === "automatic") {
                    this.#cache.filters = scran.suggestRnaQcFilters(this.#cache.metrics, { numberOfMADs: parameters.nmads, block: block });
                } else if (parameters.filter_strategy === "manual") {
                    let block_levels = this.#inputs.fetchBlockLevels();
                    this.#cache.filters = scran.emptySuggestRnaQcFiltersResults(1, block_levels === null ? 1 : block_levels.length);
                    this.#cache.filters.sum({ copy: false }).fill(parameters.sum_threshold);
                    this.#cache.filters.detected({ copy: false }).fill(parameters.detected_threshold);
                    this.#cache.filters.subsetProportion(0, { copy: false }).fill(parameters.mito_threshold);
                } else {
                    throw new Error("unknown RNA QC filtering strategy '" + filter_strategy + "'");
                }

                var keep = utils.allocateCachedArray(this.#cache.metrics.numberOfCells(), "Uint8Array", this.#cache, "keep_buffer");
                this.#cache.filters.filter(this.#cache.metrics, { block: block, buffer: keep });
                this.changed = true;
            } else {
                delete this.#cache.filters;
            }
        }

        this.#parameters = parameters;
        this.#parameters.species = bioc.CLONE(this.#parameters.species); // avoid pass-by-reference behavior.
        return;
    }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.4</a> on Sun Aug 10 2025 23:19:40 GMT+0000 (Coordinated Universal Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
